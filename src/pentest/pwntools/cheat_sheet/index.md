# PwnTools

## Installation

```shell
$ pip3 install pwntools 
```

## Exploit de code

```shell
$ pwn asm "jmp esp"
$ pwn asm -i <filepath>
```

## Check secu

```shell
$ pwn checksec <executable>
[*] '<executable>'
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX disabled
    PIE:      No PIE (0x400000)
    RWX:      Has RWX segments
```

## Motif (cyclic)

Obtenez un motif

```shell
$ pwn cyclic 30
aaaabaaacaaadaaaeaaafaaagaaaha
$ echo "prefix_$(cyclic 13)_suffix"
prefix_aaaabaaacaaad_suffix
```

## Debug

Attacher GDB à un processus

```shell
# Start and attach to binary
$ pwn debug --exec /bin/bash
# Attach to PPID
$ pwn debug --pid 1234
# Attach to current `bash`
$ pwn debug --process bash
```

## Désactiver nx

Désactive nx d'un binaire

```shell
$ pwn disablenx <filepath>
```
    
## Pwn disasm

Désassemble les opcodes hexadécimaux

```shell
$ pwn disasm ffe4
```

Peut sélectionner:

- contexte (16,32,64,linux,windows...)
- adresse de base
- couleur (par défaut)/pas de couleur

## Pwn elfdiff

Affiche les différences entre 2 fichiers

```shell
$ pwn elfdiff <file1> <file2>
```

## Pwn hex

Obtenez la représentation hexadécimale et inverse

```shell
$ pwn hex hola #Get hex of "hola" ascii
686f6c61
$ pwn unhex 686f6c61
hola
```

## Pwn phd

Obtenir le hexdump

```shell
$ pwn phd <file>
```

Peut sélectionner:

- Nombre d'octets à afficher
- Nombre d'octets par ligne à mettre en évidence
- Ignorer les octets au début

## Pwn shellcraft

Obtenir des shellcodes

```shell
#List shellcodes
$ pwn shellcraft -l

#Shellcode with amd in the name
$ pwn shellcraft -l amd 

#Create in C and run
$ pwn shellcraft -f hex amd64.linux.sh

#Run to test. Get shell
$ pwn shellcraft -r amd64.linux.sh

#Bind SH to port
$ pwn shellcraft .r amd64.linux.bindsh 9095 
```

Peut sélectionner:

- shellcode et arguments pour le shellcode
- Fichier de sortie
- Format de sortie
- déboguer (attacher dbg au shellcode)
- avant (piéger le débogage avant le code)
- après
- éviter d'utiliser des opcodes (par défaut: non nul et nouvelle ligne)
- Exécuter le shellcode
- Couleur/sans couleur
- lister les appels système
- lister les shellcodes possibles
- Générer un ELF en tant que bibliothèque partagée

## Modèle Pwn

Obtenez un modèle Python

```shell
$ pwn template
...
```

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# This exploit template was generated via:
# $ pwn template
from pwn import *

# Set up pwntools for the correct architecture
context.update(arch='i386')
exe = './path/to/binary'

# Many built-in settings can be controlled on the command-line and show up
# in "args".  For example, to dump all data sent/received, and disable ASLR
# for all created processes...
# ./exploit.py DEBUG NOASLR


def start(argv=[], *a, **kw):
    '''Start the exploit against the target.'''
    if args.GDB:
        return gdb.debug([exe] + argv, gdbscript=gdbscript, *a, **kw)
    else:
        return process([exe] + argv, *a, **kw)

# Specify your GDB script here for debugging
# GDB will be launched if the exploit is run via e.g.
# ./exploit.py GDB
gdbscript = '''
continue
'''.format(**locals())

#===========================================================
#                    EXPLOIT GOES HERE
#===========================================================

io = start()

# shellcode = asm(shellcraft.sh())
# payload = fit({
#     32: 0xdeadbeef,
#     'iaaa': [1, 2, 'Hello', 3]
# }, length=128)
# io.send(payload)
# flag = io.recv(...)
# log.success(flag)

io.interactive()
```

## Mise à jour

Pour mettre à jour pwntools

```shell
$ pwn update
```

## Best practice

Start `pwntools` then waiting for start `gdb`:

```python
from pwn import *

local_file = './some_example_elf'
p = gdb.debug(local_file)

# ... the rest of your exploit
NO_INTERACTION = True
if NO_INTERACTION:
    # For waiting GDB manual starting but close interactive action
    p.wait()
else:
    # For waiting GDB manual starting and open interactive action
    p.interactive()

# [+] Starting local process '/challenge/some_example_elf': pid 226
# [*] Paused (press any to continue)
```
- Start `GDB`

> gdb -p **\<PID\>** # 226